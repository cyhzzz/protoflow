<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProtoFlow - åŠ¨æ€å±æ€§å’Œæ¡ä»¶å¯è§æ€§æ¼”ç¤º</title>
    <link rel="stylesheet" href="src/design-system.css">
    <style>
        .demo-controls {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .demo-controls button {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .demo-state {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 4px;
            padding: 12px;
            margin-top: 12px;
            font-family: monospace;
        }
        .demo-state h4 {
            margin-top: 0;
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>ğŸ¯ ProtoFlow - åŠ¨æ€å±æ€§å’Œæ¡ä»¶å¯è§æ€§æ¼”ç¤º</h1>
        <p>å±•ç¤º ExpressionEvaluator å’Œ VisibilityChecker çš„åŠŸèƒ½</p>

        <!-- æ¼”ç¤ºæ§åˆ¶åŒº -->
        <div class="demo-controls">
            <h3>æ¼”ç¤ºæ§åˆ¶</h3>
            <button class="btn btn--primary" onclick="toggleLogin()">åˆ‡æ¢ç™»å½•çŠ¶æ€</button>
            <button class="btn btn--secondary" onclick="togglePremium()">åˆ‡æ¢VIPçŠ¶æ€</button>
            <button class="btn btn--secondary" onclick="updateBalance()">æ›´æ–°ä½™é¢</button>
            <button class="btn btn--secondary" onclick="resetState()">é‡ç½®çŠ¶æ€</button>

            <div class="demo-state">
                <h4>å½“å‰çŠ¶æ€ï¼ˆå®æ—¶ï¼‰</h4>
                <pre id="state-display"></pre>
            </div>
        </div>

        <!-- ä¸¤ä¸ªæ ·æœºå¹¶æ’å±•ç¤º -->
        <div class="main-content">
            <!-- åŸç‰ˆ -->
            <div class="phone-section">
                <h2>åŸç‰ˆé…ç½®</h2>
                <div class="phone">
                    <div class="status-bar">
                        <div class="status-bar__time" id="status-time-1">9:41</div>
                        <div class="status-bar__icons">
                            <span class="status-bar__icon">5G</span>
                            <span class="status-bar__icon">ğŸ”‹</span>
                        </div>
                    </div>
                    <div class="nav-bar">
                        <div class="nav-bar__title">æ™ºèƒ½å®¢æœ</div>
                    </div>
                    <div class="phone-content" id="phone-content-1">
                        <!-- åŸç‰ˆå†…å®¹ -->
                    </div>
                </div>
            </div>

            <!-- å¢å¼ºç‰ˆ -->
            <div class="phone-section">
                <h2>å¢å¼ºç‰ˆé…ç½®</h2>
                <div class="phone">
                    <div class="status-bar">
                        <div class="status-bar__time" id="status-time-2">9:41</div>
                        <div class="status-bar__icons">
                            <span class="status-bar__icon">5G</span>
                            <span class="status-bar__icon">ğŸ”‹</span>
                        </div>
                    </div>
                    <div class="nav-bar">
                        <div class="nav-bar__title">æ™ºèƒ½å®¢æœ</div>
                    </div>
                    <div class="phone-content" id="phone-content-2">
                        <!-- å¢å¼ºç‰ˆå†…å®¹ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½è¯´æ˜ -->
        <div class="info-card">
            <h3>âœ¨ æ–°åŠŸèƒ½è¯´æ˜</h3>
            <h4>1. åŠ¨æ€å±æ€§ï¼ˆExpressionEvaluatorï¼‰</h4>
            <ul>
                <li><code>$state</code> - è¯»å–çŠ¶æ€å€¼</li>
                <li><code>$cond</code> - æ¡ä»¶è¡¨è¾¾å¼</li>
                <li><code>$template</code> - æ¨¡æ¿å­—ç¬¦ä¸²</li>
                <li><code>$computed</code> - è°ƒç”¨è®¡ç®—å‡½æ•°</li>
            </ul>

            <h4>2. æ¡ä»¶å¯è§æ€§ï¼ˆVisibilityCheckerï¼‰</h4>
            <ul>
                <li><code>visible</code> - æ˜¾ç¤ºæ¡ä»¶</li>
                <li><code>hidden</code> - éšè—æ¡ä»¶</li>
                <li>æ”¯æŒ AND/OR é€»è¾‘ç»„åˆ</li>
            </ul>

            <h4>3. å†…ç½®è®¡ç®—å‡½æ•°</h4>
            <ul>
                <li><code>formatCurrency</code> - æ ¼å¼åŒ–è´§å¸</li>
                <li><code>formatDate</code> - æ ¼å¼åŒ–æ—¥æœŸ</li>
                <li><code>formatNumber</code> - æ ¼å¼åŒ–æ•°å­—</li>
                <li><code>formatPercent</code> - æ ¼å¼åŒ–ç™¾åˆ†æ¯”</li>
            </ul>
        </div>
    </div>

    <script src="src/core/ExpressionEvaluator.js"></script>
    <script src="src/core/VisibilityChecker.js"></script>
    <script src="src/protoflow-enhanced.js"></script>
    <script>
        // çŠ¶æ€ç®¡ç†
        let appState = {
            user: {
                name: 'å¼ ä¸‰',
                loggedIn: false,
                premium: false
            },
            account: {
                balance: 123456.78
            }
        };

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStateDisplay() {
            const display = document.getElementById('state-display');
            display.textContent = JSON.stringify(appState, null, 2);
        }

        // åˆ‡æ¢ç™»å½•çŠ¶æ€
        function toggleLogin() {
            appState.user.loggedIn = !appState.user.loggedIn;
            updateStateDisplay();
            alert(`ç™»å½•çŠ¶æ€ï¼š${appState.user.loggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}`);
        }

        // åˆ‡æ¢VIPçŠ¶æ€
        function togglePremium() {
            appState.user.premium = !appState.user.premium;
            updateStateDisplay();
            alert(`VIPçŠ¶æ€ï¼š${appState.user.premium ? 'æ˜¯VIP' : 'æ™®é€šç”¨æˆ·'}`);
        }

        // æ›´æ–°ä½™é¢
        function updateBalance() {
            const newBalance = parseFloat(prompt('è¾“å…¥æ–°ä½™é¢ï¼š', appState.account.balance));
            if (!isNaN(newBalance)) {
                appState.account.balance = newBalance;
                updateStateDisplay();
            }
        }

        // é‡ç½®çŠ¶æ€
        function resetState() {
            appState = {
                user: {
                    name: 'å¼ ä¸‰',
                    loggedIn: false,
                    premium: false
                },
                account: {
                    balance: 123456.78
                }
            };
            updateStateDisplay();
            alert('çŠ¶æ€å·²é‡ç½®');
        }

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const time = `${hours}:${minutes}`;

            document.getElementById('status-time-1').textContent = time;
            document.getElementById('status-time-2').textContent = time;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStateDisplay();
            updateTime();
            setInterval(updateTime, 60000);
        });
    </script>
</body>
</html>
